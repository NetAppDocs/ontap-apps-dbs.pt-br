---
sidebar: sidebar 
permalink: vmware/vmware-vvols-overview.html 
keywords: tr-4400, vvols, ontap, virtual volumes 
summary: 'Esta é uma visão geral do VMware vSphere Virtual volumes (vVols) com o ONTAP' 
---
= Visão geral
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
O ONTAP é uma solução de storage líder para ambientes VMware vSphere há mais de duas décadas e continua adicionando recursos inovadores para simplificar o gerenciamento e reduzir custos.

Este documento abrange os recursos do ONTAP para volumes virtuais do VMware vSphere (vVols), incluindo as informações mais recentes sobre produtos e casos de uso, juntamente com as práticas recomendadas e outras informações para simplificar a implantação e reduzir erros.


NOTE: Essa documentação substitui os relatórios técnicos publicados anteriormente _TR-4400: VMware vSphere Virtual volumes (vVols) com o ONTAP_

As práticas recomendadas complementam outros documentos, como guias e listas de compatibilidade. Eles são desenvolvidos com base em testes de laboratório e extensa experiência de campo por engenheiros e clientes da NetApp. Eles podem não ser as únicas práticas que funcionam ou são suportadas, mas são geralmente as soluções mais simples que atendem às necessidades da maioria dos clientes.


NOTE: Este documento foi atualizado para incluir novos recursos do vVols encontrados na atualização 3 do vSphere 8,0, na versão 10,4 das ferramentas do ONTAP e nos novos sistemas NetApp ASA.



== Visão geral dos volumes virtuais (vVols)

A NetApp começou a trabalhar com a VMware para oferecer suporte às APIs do vSphere for Storage Awareness (VASA) para o vSphere 5 em 2012. Este provedor VASA inicial permitiu a definição de recursos de armazenamento em um perfil que poderia ser usado para filtrar datastores ao provisionar e verificar a conformidade com a política posteriormente. Com o tempo, isso evoluiu para adicionar novos recursos para permitir mais automação no provisionamento, bem como adicionar volumes virtuais ou vVols, onde objetos de storage individuais são usados para arquivos de máquina virtual e discos virtuais. Esses objetos podem ser LUNs, arquivos e agora com os namespaces vSphere 8 - NVMe (usados com as ferramentas do ONTAP 9.13P2). A NetApp trabalhou em estreita colaboração com a VMware como parceiro de referência do vVols lançado com o vSphere 6 em 2015 e novamente como parceiro de design do vVols usando o NVMe sobre Fabrics no vSphere 8. A NetApp continua a aprimorar os vVols para aproveitar os recursos mais recentes do ONTAP.

Existem vários componentes a ter em conta:



=== Fornecedor VASA

Este é o componente de software que lida com a comunicação entre o VMware vSphere e o sistema de storage. Para o ONTAP, o provedor VASA é executado em um dispositivo conhecido como ferramentas ONTAP para VMware vSphere (ferramentas ONTAP para abreviação). As ferramentas do ONTAP também incluem um plug-in do vCenter, um adaptador de replicação de armazenamento (SRA) para o VMware Site Recovery Manager e um servidor de API REST para criar sua própria automação. Depois que as ferramentas do ONTAP são configuradas e registradas no vCenter, há pouca necessidade de interagir diretamente com o sistema ONTAP, já que quase todas as suas necessidades de armazenamento podem ser gerenciadas diretamente na IU do vCenter ou por meio da automação da API REST.



=== Ponto final do protocolo (PE)

O endpoint do protocolo é um proxy para e/S entre os hosts ESXi e o datastore vVols. O Fornecedor ONTAP VASA cria-os automaticamente, seja um LUN de ponto de extremidade de protocolo (4MB GB de tamanho) por FlexVol volume do armazenamento de dados vVols ou um ponto de montagem NFS por interface NFS (LIF) no nó de storage que hospeda um FlexVol volume no armazenamento de dados. O host ESXi monta esses pontos finais do protocolo diretamente em vez de LUNs e arquivos de disco virtuais individuais da Vevolve. Não é necessário gerenciar os endpoints do protocolo à medida que são criados, montados, desmontados e excluídos automaticamente pelo Provedor VASA, juntamente com quaisquer grupos de interface ou políticas de exportação necessárias.



=== Ponto final do protocolo virtual (VPE)

Novidade no vSphere 8: Ao usar o NVMe sobre Fabrics (NVMe-of) com vVols, o conceito de endpoint de protocolo não é mais relevante no ONTAP. Em vez disso, um PE virtual é instanciado automaticamente pelo host ESXi para cada grupo ANA assim que a primeira VM é ativada. O ONTAP cria automaticamente grupos ANA para cada FlexVol volume usado pelo datastore.

Uma vantagem adicional ao usar o NVMe-of para vVols é que não há solicitações de vinculação necessárias do Fornecedor VASA. Em vez disso, o host ESXi lida internamente com a funcionalidade de vinculação do VPE. Isso reduz a oportunidade de uma tempestade de Vevolve para impactar o serviço.

Para obter mais informações, consulte a. https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["NVMe e Virtual volumes"^] https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["vmware.com"^]



=== Armazenamento de dados de volume virtual

O armazenamento de dados de Volume Virtual é uma representação lógica de um contêiner vVols , criado e mantido por um Provedor VASA. O contêiner representa um conjunto de capacidade de armazenamento fornecida por sistemas de armazenamento gerenciados pelo Provedor VASA. As ferramentas ONTAP suportam a alocação de múltiplos volumes FlexVol (referidos como volumes de suporte) a um único armazenamento de dados vVols , e esses armazenamentos de dados vVols podem abranger vários nós em um cluster ONTAP , combinando sistemas flash e híbridos com diferentes capacidades. O administrador pode criar novos volumes FlexVol usando o assistente de provisionamento ou a API REST, ou selecionar volumes FlexVol pré-criados para armazenamento de suporte, caso estejam disponíveis.



=== Volumes virtuais (vVols)

Os vVols são os arquivos e discos reais das máquinas virtuais armazenados no datastore vVols . O termo vVol (singular) refere-se a um único arquivo específico, LUN ou namespace. O ONTAP cria namespaces NVMe, LUNs ou arquivos, dependendo do protocolo usado pelo armazenamento de dados. Existem vários tipos distintos de vVols; os mais comuns são Config (o único com VMFS, contendo arquivos de metadados como o arquivo VMX da VM), Data (disco virtual ou VMDK) e Swap (criado quando a VM é ligada). Os vVols protegidos pela criptografia de VM da VMware serão do tipo Outro. A criptografia de máquinas virtuais VMware não deve ser confundida com a criptografia de volumes ou agregados do ONTAP .



== Gestão baseada em políticas

As APIs do VMware vSphere para Conscientização de Armazenamento (VASA) facilitam para um administrador de máquinas virtuais usar quaisquer recursos de armazenamento necessários para provisionar máquinas virtuais sem precisar interagir com sua equipe de armazenamento. Antes do VASA, os administradores de VMs podiam definir políticas de armazenamento de VMs, mas precisavam trabalhar com seus administradores de armazenamento para identificar os datastores apropriados, geralmente usando documentação ou convenções de nomenclatura. Com o VASA, os administradores do vCenter com as permissões apropriadas podem definir uma variedade de recursos de armazenamento que os usuários do vCenter podem usar para provisionar máquinas virtuais. O mapeamento entre a política de armazenamento da VM e os recursos do datastore permite que o vCenter exiba uma lista de datastores compatíveis para seleção, além de possibilitar que outras tecnologias, como o VCF (anteriormente conhecido como Aria e vRealize) Automation ou o VMware vSphere Kubernetes Service (VKS), selecionem automaticamente o armazenamento a partir de uma política atribuída. Essa abordagem é conhecida como gerenciamento baseado em políticas de armazenamento. Embora as regras do provedor VASA e as políticas de armazenamento de VM também possam ser usadas com datastores tradicionais, nosso foco aqui está nos datastores vVols .



=== Políticas de storage de VM

As políticas de armazenamento de VM são criadas no vCenter em políticas e perfis. Para vVols, crie um conjunto de regras usando regras do provedor do tipo de storage do NetApp vVols. As ferramentas do ONTAP 10.X agora oferecem uma abordagem mais simples do que as ferramentas do ONTAP 9.X, permitindo que você especifique diretamente atributos de armazenamento na própria política de armazenamento de VM.

Como mencionado acima, o uso de políticas pode ajudar a simplificar a tarefa de provisionar uma VM ou VMDK. Basta selecionar uma política apropriada e o Fornecedor VASA mostrará os datastores da vols que suportam essa política e colocam a evolução em um FlexVol volume individual que esteja em conformidade.



=== Implante a VM usando a Política de storage

image::vvols-image3.png[Implante a máquina virtual usando a política de armazenamento,800,480]

Após o provisionamento de uma VM, o provedor VASA continuará verificando a conformidade e alertará o administrador da VM com um alarme no vCenter quando o volume de suporte deixar de estar em conformidade com a política.



=== Conformidade com a política de storage da VM

image::vvols-image4.png[Conformidade com a política de armazenamento de máquinas virtuais,320,100]



== Suporte para NetApp vVols

O ONTAP oferece suporte à especificação VASA desde seu lançamento inicial em 2012. Embora outros sistemas de armazenamento NetApp possam suportar VASA, este documento se concentra nas versões atualmente suportadas do ONTAP 9.



=== ONTAP

Além do ONTAP 9 nos sistemas AFF, ASA e FAS , o NetApp oferece suporte a cargas de trabalho VMware no ONTAP Select, Amazon FSx para NetApp com VMware Cloud na AWS, Azure NetApp Files com Azure VMware Solution, Google Cloud NetApp Volumes com Google Cloud VMware Engine e NetApp Private Storage no Equinix, mas a funcionalidade específica pode variar com base no provedor de serviços e na conectividade de rede disponível.

No momento da publicação, os ambientes de hiperescala estão limitados a datastores NFS v3 tradicionais; portanto, os vVols estão disponíveis apenas com sistemas ONTAP locais ou sistemas conectados à nuvem que oferecem a funcionalidade completa de um sistema local, como aqueles hospedados por parceiros e provedores de serviços da NetApp em todo o mundo.

_Para obter mais informações sobre o ONTAP, https://docs.netapp.com/us-en/ontap-family/["Documentação do produto ONTAP"^] consulte _

_Para obter mais informações sobre as práticas recomendadas do ONTAP e do VMware vSphere, link:vmware-vsphere-overview.html["TR-4597"^]consulte _



== Benefícios de usar vVols com ONTAP

Quando a VMware introduziu o suporte a vVols com o VASA 2.0 em 2015, descreveu-o como "uma estrutura de integração e gestão que oferece um novo modelo operacional para armazenamento externo (SAN/NAS)". Este modelo operacional oferece diversas vantagens em conjunto com o armazenamento ONTAP .



=== Gestão baseada em políticas

Conforme abordado na seção 1.2, o gerenciamento baseado em políticas permite que as VMs sejam provisionadas e posteriormente gerenciadas usando políticas predefinidas. Isso pode ajudar as operações de TI de diversas maneiras:

* *Aumente a velocidade.* As ferramentas ONTAP eliminam a necessidade de o administrador do vCenter abrir chamados com a equipe de armazenamento para atividades de provisionamento de armazenamento. No entanto, as funções RBAC das ferramentas ONTAP no vCenter e no sistema ONTAP ainda permitem equipes independentes (como equipes de armazenamento) ou atividades independentes da mesma equipe, restringindo o acesso a funções específicas, se desejado.
* *Provisionamento mais inteligente.* Os recursos do sistema de storage podem ser expostos por meio das APIs VASA, permitindo que os fluxos de trabalho de provisionamento aproveitem recursos avançados sem que o administrador da VM precise entender como gerenciar o sistema de storage.
* *Provisionamento mais rápido.* Diferentes recursos de storage podem ser suportados em um único armazenamento de dados e selecionados automaticamente, conforme apropriado, para uma VM com base na política de VM.
* *Evite erros.* As políticas de storage e VM são desenvolvidas com antecedência e aplicadas conforme necessário, sem precisar personalizar o storage sempre que uma VM é provisionada. Os alarmes de conformidade são gerados quando as funcionalidades de storage são desviadas das políticas definidas. Como mencionado anteriormente, as SCPs tornam o provisionamento inicial previsível e repetível, ao mesmo tempo que basear as políticas de armazenamento de VM nos SCPs garante um posicionamento preciso.
* * Melhor gerenciamento de capacidade. * As ferramentas VASA e ONTAP possibilitam visualizar a capacidade de armazenamento até o nível de agregado individual, se necessário, e fornecem várias camadas de alertas no evento que a capacidade começa a ficar baixa.




=== Gerenciamento granular de VM na SAN moderna

Os sistemas de armazenamento SAN que utilizam Fibre Channel e iSCSI foram os primeiros a serem suportados pela VMware para ESX, mas não possuíam a capacidade de gerenciar arquivos e discos individuais de máquinas virtuais a partir do sistema de armazenamento. Em vez disso, os LUNs são provisionados e o VMFS gerencia os arquivos individuais. Isso dificulta o gerenciamento direto, pelo sistema de armazenamento, do desempenho, da clonagem e da proteção do armazenamento de máquinas virtuais individuais. Os vVols oferecem a granularidade de armazenamento que os clientes que usam armazenamento NFS já desfrutam, com os recursos robustos e de alto desempenho de SAN do ONTAP.

Agora, com o vSphere 8 e as ONTAP tools for VMware vSphere 9.12 e versões posteriores, esses mesmos controles granulares usados ​​pelos vVols para protocolos legados baseados em SCSI estão disponíveis no SAN Fibre Channel moderno usando NVMe over Fabrics para um desempenho ainda maior em escala. Com a atualização 1 do vSphere 8.0, agora é possível implantar uma solução NVMe completa de ponta a ponta usando vVols sem qualquer tradução de E/S na pilha de armazenamento do hipervisor.



=== Maiores funcionalidades de descarga de storage

Embora a VAAI ofereça uma variedade de operações que são descarregadas para armazenamento, existem algumas lacunas que são abordadas pelo provedor VASA. O SAN VAAI não consegue descarregar snapshots gerenciados pelo VMware para o sistema de armazenamento. O NFS VAAI pode descarregar snapshots gerenciados por VMs, mas existem limitações impostas a uma VM com snapshots nativos de armazenamento. Como os vVols usam LUNs, namespaces ou arquivos individuais para discos de máquinas virtuais, o ONTAP pode clonar os arquivos ou LUNs de forma rápida e eficiente para criar snapshots granulares de VM que não exigem mais arquivos delta. O NFS VAAI também não oferece suporte ao descarregamento de operações de clonagem para migrações Storage vMotion a quente (com o sistema ligado). A máquina virtual deve ser desligada para permitir o descarregamento da migração ao usar o VAAI com armazenamentos de dados NFS tradicionais. O provedor VASA nas ferramentas ONTAP permite clones quase instantâneos e com uso eficiente de armazenamento para migrações a quente e a frio, além de suportar cópias quase instantâneas para migrações entre volumes virtuais (vVols). Graças a esses benefícios significativos de eficiência de armazenamento, você poderá aproveitar ao máximo as cargas de trabalho do vVols no âmbito do https://www.netapp.com/pdf.html?item=/media/8207-flyer-efficiency-guaranteepdf.pdf["Garantia de eficiência"] programa. Da mesma forma, se as clonagens entre volumes usando VAAI não atenderem aos seus requisitos, você provavelmente conseguirá resolver seu desafio de negócios graças às melhorias na experiência de cópia com vVols.



=== Casos de uso comuns para vVols

Além desses benefícios, também vemos esses casos de uso comuns para o storage da evolução:

* *Provisionamento sob demanda de VMs*
+
** IaaS provedor de serviços ou nuvem privada.
** Aproveite a automação e a orquestração por meio do pacote Aria (anteriormente vRealize), OpenStack e assim por diante.


* *Discos de primeira Classe (FCDs)*
+
** Volumes persistentes do VMware vSphere Kubernetes Service (VKS).
** Fornecer serviços semelhantes ao Amazon EBS por meio de gerenciamento independente do ciclo de vida do VMDK.


* *Provisionamento sob demanda de VMs temporárias*
+
** Laboratórios de teste/desenvolvimento
** Ambientes de treinamento






=== Benefícios comuns com vVols

Quando usados em seu pleno benefício, como nos casos de uso acima, o vVols fornece as seguintes melhorias específicas:

* Os clones são criados rapidamente dentro de um único volume ou em vários volumes em um cluster ONTAP , o que representa uma vantagem em comparação com os clones tradicionais habilitados para VAAI. Eles também são eficientes em termos de armazenamento. Os clones dentro de um volume usam o clone de arquivo ONTAP , que é semelhante aos volumes FlexClone e armazena apenas as alterações do arquivo/LUN/namespace do vVol de origem. Dessa forma, máquinas virtuais (VMs) de longo prazo para produção ou outros fins de aplicação são criadas rapidamente, ocupam espaço mínimo e podem se beneficiar da proteção em nível de VM (usando o plug-in NetApp SnapCenter para VMware vSphere, snapshots gerenciados pela VMware ou backup VADP) e do gerenciamento de desempenho (com QoS do ONTAP ). A clonagem entre volumes é muito mais rápida com vVols do que com VAAI, porque com VASA podemos criar o clone e permitir o acesso a ele no destino antes que a cópia seja concluída. Os blocos de dados são copiados como um processo em segundo plano para preencher o vVol de destino. Isso é semelhante à forma como a movimentação não disruptiva de LUNs do ONTAP funciona para LUNs tradicionais.
* Os vVols são a tecnologia de armazenamento ideal ao usar o TKG com o vSphere CSI, fornecendo classes de armazenamento discretas e capacidades gerenciadas pelo administrador do vCenter.
* Serviços semelhantes ao Amazon EBS podem ser fornecidos por meio de FCDs porque um VMDK de FCD, como o nome sugere, é um elemento de primeira classe no vSphere e possui um ciclo de vida que pode ser gerenciado independentemente, separado das VMs às quais possa estar associado.


---
sidebar: sidebar 
permalink: vmware/vmware-vvols-deploy.html 
keywords: tr-4400, vvols, ontap, virtual volumes, deploy, ASA r2, ASA, AFF, FAS, vSphere, VMware 
summary:  
---
= Implantação de vVols em sistemas AFF, ASA, ASA R2 e FAS
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Siga estas práticas recomendadas para criar armazenamento vVols para suas máquinas virtuais.

O provisionamento de armazenamentos de dados vVols envolve várias etapas. Os sistemas ASA R2 da NetApp foram projetados para cargas de trabalho VMware e oferecem uma experiência do usuário diferente dos sistemas ONTAP tradicionais. Ao usar os sistemas ASA R2, as ferramentas do ONTAP 10,3 ou posterior exigem menos etapas para configurar e incluem extensões de IU e suporte à API REST otimizadas para a nova arquitetura de storage.



== Preparando-se para criar datastores vVols com as ferramentas do ONTAP

Você pode ignorar as duas primeiras etapas do processo de implantação se você já estiver usando ferramentas do ONTAP para gerenciar, automatizar e gerar relatórios sobre o seu storage VMFS existente ou baseado em NFS tradicional. Você também pode consultar este completo link:vmware-vvols-checklist.html["lista de verificação"] para implantar e configurar ferramentas do ONTAP.

. Crie a Máquina Virtual de Armazenamento (SVM) e sua configuração de protocolo. Note que isso pode não ser necessário para sistemas ASA r2, já que eles normalmente já possuem uma única SVM para serviços de dados. Você deverá selecionar NVMe/FC (somente para ONTAP tools 9.13), NFSv3, NFSv4.1, iSCSI, FCP ou uma combinação dessas opções. NVMe/TCP e NVMe/FC também podem ser usados ​​para armazenamentos de dados VMFS tradicionais com as ferramentas ONTAP 10.3 e posteriores. Você pode usar os assistentes do ONTAP System Manager ou a linha de comando do shell do cluster.
+
** https://docs.netapp.com/us-en/ontap/disks-aggregates/assign-aggregates-svms-task.html["Atribua camadas locais (agregados) a SVMs"] Para todos os sistemas que não sejam ASA R2.
** Pelo menos um LIF por nó para cada conexão de switch/malha. Como prática recomendada, crie dois ou mais por nó para protocolos baseados em FCP, iSCSI ou NVMe. Um LIF por nó é suficiente para vVols baseados em NFS, mas esse LIF deve ser protegido por um ifgroup LACP.  https://docs.netapp.com/us-en/ontap/networking/configure_lifs_cluster_administrators_only_overview.html["Configure a visão geral dos LIFs"]Consulte e https://docs.netapp.com/us-en/ontap/networking/combine_physical_ports_to_create_interface_groups.html["Combine portas físicas para criar grupos de interface"] para obter detalhes.
** É necessário pelo menos um LIF de gerenciamento por SVM se você pretende usar credenciais com escopo de SVM para seus vCenters de locatário.
** Se você planeja usar o SnapMirror, verifique se o código fonte e o destino https://docs.netapp.com/us-en/ontap/peering/["Os clusters e SVMs do ONTAP são peered"].
** Para sistemas que não sejam ASA r2, os volumes podem ser criados neste momento, mas a melhor prática é deixar que o assistente _Provision Datastore_ nas ferramentas ONTAP os crie. A única exceção a essa regra é se você planeja usar a replicação de vVols com o VMware Site Recovery Manager e as ferramentas ONTAP 9.13. Isso é mais fácil de configurar com volumes FlexVol preexistentes que já possuam relações SnapMirror . Tenha cuidado para não ativar o QoS em nenhum volume que será usado para vVols, pois isso deve ser gerenciado pelas ferramentas SPBM e ONTAP .


. https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/ontap-tools-deployment.html["Implantar as ferramentas do ONTAP para o VMware vSphere"] Usando o OVA baixado do site de suporte da NetApp.
+
** O ONTAP Tools 10.0 e versões posteriores suportam vários servidores vCenter por appliance; não é mais necessário implantar um appliance ONTAP Tools por vCenter.
+
*** Se você planeja conectar vários vCenters a uma única instância do ONTAP Tools, você deve criar e instalar certificados assinados por uma Autoridade Certificadora (CA). Consulte https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/certificate-manage.html["Gerenciar certificados"] para etapas.


** A partir da versão 10.3, as ferramentas ONTAP agora são implantadas como um dispositivo de pequeno porte com um único nó, adequado para a maioria das cargas de trabalho que não utilizam vVols.




[TIP]
====
* A melhor prática recomendada é: https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/edit-appliance-settings.html["Ferramentas de ONTAP com escalabilidade horizontal"] A partir da versão 10.3, foi implementada a configuração de alta disponibilidade (HA) de 3 nós para todas as cargas de trabalho de produção. Para fins de laboratório ou teste, é possível usar uma implantação de nó único.
* A melhor prática recomendada para o uso de vVols em produção é eliminar qualquer ponto único de falha. Crie regras de antiafinidade para impedir que as VMs das ferramentas ONTAP sejam executadas juntas no mesmo host. Após a implantação inicial, também é recomendável usar o Storage vMotion para mover as VMs das ferramentas ONTAP para diferentes datastores. Leia mais sobre https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0/using-drs-clusters-to-manage-resources/using-affinity-rules-without-vsphere-drs.html["Usando o Affinity Rules sem o vSphere DRS"] ou https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0/using-drs-clusters-to-manage-resources/create-a-vm-vm-affinity-rule.html["Crie uma regra de afinidade VM-VM"]. Você também deve agendar backups frequentes e/ou https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/backup-settings.html["utilize o utilitário de cópia de segurança de configuração incorporado"].


====
. Configure as ferramentas do ONTAP 10,3 para o seu ambiente.
+
** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-vcenter.html["Adicione instâncias do vCenter Server"] Na IU do Gerenciador de ferramentas do ONTAP.
** As ferramentas do ONTAP 10,3 são compatíveis com a alocação segura a vários clientes. Se você não precisar de alocação segura a vários clientes, basta https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-storage-backend.html["Adicione seus clusters ONTAP"] ir ao menu Ferramentas do ONTAP no vCenter e clicar em _backends de armazenamento_ e clicar no botão _add_.
** Em um ambiente multitenant seguro onde você deseja delegar SVMs (Storage Virtual Machines) específicas em vCenters específicos, você deve fazer o seguinte.
+
*** Faça login na IU do Gerenciador de ferramentas do ONTAP
*** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-storage-backend.html["Integrar o cluster de storage"]
*** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/associate-storage-backend.html["Associar um back-end de storage a uma instância do vCenter Server"]
*** Forneça as credenciais específicas da SVM ao administrador do vCenter, que então adicionará a SVM como um backend de armazenamento no menu de backends de armazenamento das ferramentas ONTAP no vCenter.






[TIP]
====
* É uma prática recomendada criar funções de RBAC para suas contas de storage.
* As ferramentas ONTAP incluem um arquivo JSON contendo as permissões de função necessárias para as contas de armazenamento das ferramentas ONTAP . Você pode carregar o arquivo JSON no ONTAP System Manager para simplificar a criação de funções e usuários RBAC.
* Você pode ler mais sobre as funções RBAC do ONTAP em https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/configure-user-role-and-privileges.html#svm-aggregate-mapping-requirements["Configurar as funções de usuário do ONTAP e o Privileges"].


====

NOTE: O motivo pelo qual todo o cluster precisa ser integrado à interface do usuário do gerenciador de ferramentas ONTAP é que muitas das APIs usadas para vVols estão disponíveis apenas no nível do cluster.



== Criação de datastores vVols com as ferramentas do ONTAP

Clique com o botão direito do Mouse no host, cluster ou datacenter no qual você deseja criar o datastore vVols e selecione _ONTAP Tools_ > _provision datastore_.

image:vvols-deploy-1.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Escolha vVols e forneça um nome significativo e selecione o protocolo desejado. Você também pode fornecer uma descrição do datastore.
+
** Ferramentas ONTAP 10,3 com ASA R2.




image:vvols-deploy-2.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Selecione o SVM do sistema ASA R2 e clique em _next_.


image:vvols-deploy-3.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Clique em _finish_


image:vvols-deploy-4.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* É tão fácil!
+
** Ferramentas ONTAP 10.3 com ONTAP FAS, AFF e ASA anteriores ao ASA r2.


* Selecione o protocolo


image:vvols-deploy-5.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Selecione o SVM e clique em _next_.


image:vvols-deploy-5a.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Clique em _adicionar novos volumes_ ou _usar volume existente_ e especifique os atributos. Note que nas ferramentas ONTAP 10.3, você pode solicitar a criação de vários volumes simultaneamente. Você também pode adicionar manualmente vários volumes para distribuí-los pelo cluster ONTAP . Clique em _próximo_


image:vvols-deploy-6.png["Função \"Thumb\" \"provision datastore wizard\",300"]

image:vvols-deploy-7.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Clique em _finish_


image:vvols-deploy-8.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Você pode ver os volumes atribuídos no menu Ferramentas do ONTAP da guia configurar para o datastore.


image:vvols-deploy-9.png["Função \"Thumb\" \"provision datastore wizard\",300"]

* Agora você pode criar políticas de armazenamento de VM a partir do menu _políticas e Perfis_ na IU do vCenter.




== Migração de VMs de datastores tradicionais para vVols

A migração de VMs de datastores tradicionais para um datastore vVols é tão simples quanto mover VMs entre datastores tradicionais. Basta selecionar a(s) VM(s), depois selecionar migrar da lista de ações e selecionar um tipo de migração de _change storage only_. Quando solicitado, selecione uma política de armazenamento de VM que corresponda ao armazenamento de dados do vVols. As operações de cópia de migração podem ser descarregadas com o vSphere 6,0 e posterior para migrações SAN VMFS para vVols, mas não de VMDKs nas para vVols.



== Gerenciamento de VMs com políticas

Para automatizar o provisionamento de armazenamento com gerenciamento baseado em políticas, você precisa criar políticas de armazenamento de VM que correspondam aos recursos de armazenamento desejados.


NOTE: As ferramentas do ONTAP 10,0 e posteriores não usam mais perfis de capacidade de armazenamento como as versões anteriores. Em vez disso, os recursos de storage são definidos diretamente na própria política de storage da VM.



=== Criando políticas de armazenamento de VM

As políticas de armazenamento de máquinas virtuais (VMs) são usadas no vSphere para gerenciar recursos opcionais, como o controle de E/S de armazenamento ou a criptografia do vSphere. Eles também são usados ​​com vVols para aplicar recursos de armazenamento específicos à máquina virtual. Utilize o tipo de armazenamento " NetApp ". Veja o link:vmware-vvols-ontap.html#Best Practices[exemplo de configuração de rede usando vVols sobre NFS v3] para um exemplo disso com o provedor VASA das ferramentas ONTAP . As regras para o armazenamento "NetApp" devem ser usadas com datastores que não ONTAP baseados em vVols.

Uma vez criada a política de storage, ela pode ser usada ao provisionar novas VMs.

image:vmware-vvols-deploy-vmsp-01.png["Criação de políticas de armazenamento de VM com ferramentas ONTAP Fornecedor VASA 9,10\",300"] image:vmware-vvols-deploy-vmsp-02.png["Criação de políticas de armazenamento de VM com ferramentas ONTAP Fornecedor VASA 9,10\",300"] image:vmware-vvols-deploy-vmsp-03.png["Criação de políticas de armazenamento de VM com ferramentas ONTAP Fornecedor VASA 9,10\",300"] image:vmware-vvols-deploy-vmsp-04.png["Criação de políticas de armazenamento de VM com ferramentas ONTAP Fornecedor VASA 9,10\",300"] image:vmware-vvols-deploy-vmsp-05.png["Criação de políticas de armazenamento de VM com ferramentas ONTAP Fornecedor VASA 9,10\",300"] image:vmware-vvols-deploy-vmsp-06.png["Criação de políticas de armazenamento de VM com ferramentas ONTAP Fornecedor VASA 9,10\",300"] image:vmware-vvols-deploy-vmsp-07.png["Criação de políticas de armazenamento de VM com ferramentas ONTAP Fornecedor VASA 9,10\",300"]



==== Gerenciamento de performance com ferramentas ONTAP

As ferramentas da ONTAP usam seu próprio algoritmo de colocação equilibrada para colocar uma nova evolução no melhor FlexVol volume com sistemas ASA unificados ou clássicos, ou zona de disponibilidade de armazenamento (SAZ) com sistemas ASA R2, dentro de um datastore da vVols. O posicionamento é baseado na correspondência do armazenamento de backup com a política de armazenamento de VM. Isso garante que o armazenamento de dados e o armazenamento de backup possam atender aos requisitos de desempenho especificados.

Alterar as capacidades de desempenho, como IOPS mínimo e máximo, requer atenção à configuração específica.

* *IOPS mínimo e máximo* podem ser especificados em uma política de VM.
+
** Alterar o IOPS na política não alterará a QoS nos vVols até que a Política de VM seja reaplicada às VMs que a utilizam. Ou você pode criar uma nova política com o IOPS desejado e aplicá-la às VMs de destino. Em geral, recomenda-se simplesmente definir políticas de armazenamento de VM separadas para diferentes níveis de serviço e alterar a política de armazenamento da VM diretamente na VM.
** As personalidades ASA, ASA r2, AFF e FAS possuem configurações de PIO (pressão intraocular) diferentes. As opções Min e Max estão disponíveis em todos os sistemas flash; no entanto, sistemas que não sejam AFF só podem usar as configurações de IOPS máximo.


* As ferramentas do ONTAP criam políticas individuais de QoS não compartilhadas com versões atualmente suportadas do ONTAP. Portanto, cada VMDK individual receberá sua própria alocação de IOPs.




===== Reaplicar a política de armazenamento de VM

image:vvols-image16.png["\"Reaplicando a política de armazenamento de VM\",300"]
